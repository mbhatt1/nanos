import{_ as s,c as a,o as i,ah as n}from"./chunks/framework.CI1pfr7V.js";const l=JSON.parse('{"title":"Authority Kernel","description":"","frontmatter":{},"headers":[],"relativePath":"architecture/authority-kernel.md","filePath":"architecture/authority-kernel.md","lastUpdated":1768626356000}');const e=s({name:"architecture/authority-kernel.md"},[["render",function(s,l,e,p,t,h){return i(),a("div",null,[...l[0]||(l[0]=[n('<h1 id="authority-kernel" tabindex="-1">Authority Kernel <a class="header-anchor" href="#authority-kernel" aria-label="Permalink to &quot;Authority Kernel&quot;">​</a></h1><p>The Authority Kernel (AK) is the security subsystem that enforces deny-by-default access control for AI agents.</p><h2 id="design-principles" tabindex="-1">Design Principles <a class="header-anchor" href="#design-principles" aria-label="Permalink to &quot;Design Principles&quot;">​</a></h2><h3 id="_1-single-authority-gate" tabindex="-1">1. Single Authority Gate <a class="header-anchor" href="#_1-single-authority-gate" aria-label="Permalink to &quot;1. Single Authority Gate&quot;">​</a></h3><p>All effectful operations pass through ONE function:</p><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ak_authorize_and_execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    ak_ctx_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ak_effect_req_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    ak_decision_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">decision_out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    long</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">retval_out</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>This ensures consistent policy enforcement across all code paths.</p><h3 id="_2-deny-by-default" tabindex="-1">2. Deny-by-Default <a class="header-anchor" href="#_2-deny-by-default" aria-label="Permalink to &quot;2. Deny-by-Default&quot;">​</a></h3><p>If policy cannot explicitly prove an operation is allowed, it is denied:</p><ul><li>Missing policy = fail closed</li><li>Unknown operation = denied</li><li>Ambiguous match = denied</li></ul><h3 id="_3-effects-not-syscalls" tabindex="-1">3. Effects, Not Syscalls <a class="header-anchor" href="#_3-effects-not-syscalls" aria-label="Permalink to &quot;3. Effects, Not Syscalls&quot;">​</a></h3><p>POSIX syscalls are translated into <strong>effects</strong> for policy evaluation:</p><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ak_effect_op {</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Filesystem effects */</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AK_E_FS_OPEN        </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AK_E_FS_UNLINK      </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0101</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AK_E_FS_RENAME      </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0102</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AK_E_FS_MKDIR       </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0103</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Network effects */</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AK_E_NET_CONNECT    </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AK_E_NET_DNS_RESOLVE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0201</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AK_E_NET_BIND       </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0202</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AK_E_NET_LISTEN     </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0203</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Agentic effects */</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AK_E_TOOL_CALL      </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AK_E_WASM_INVOKE    </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0401</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AK_E_INFER          </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0402</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ak_effect_op_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="request-validation-pipeline" tabindex="-1">Request Validation Pipeline <a class="header-anchor" href="#request-validation-pipeline" aria-label="Permalink to &quot;Request Validation Pipeline&quot;">​</a></h2><p>Every request passes through these stages:</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────┐</span></span>\n<span class="line"><span>│   RECEIVE   │  Read request</span></span>\n<span class="line"><span>└──────┬──────┘</span></span>\n<span class="line"><span>       ↓</span></span>\n<span class="line"><span>┌─────────────┐</span></span>\n<span class="line"><span>│  1. PARSE   │  Validate syntax</span></span>\n<span class="line"><span>└──────┬──────┘</span></span>\n<span class="line"><span>       ↓</span></span>\n<span class="line"><span>┌─────────────┐</span></span>\n<span class="line"><span>│  2. SCHEMA  │  Validate structure</span></span>\n<span class="line"><span>└──────┬──────┘</span></span>\n<span class="line"><span>       ↓</span></span>\n<span class="line"><span>┌─────────────┐</span></span>\n<span class="line"><span>│ 3. SEQUENCE │  Anti-replay check</span></span>\n<span class="line"><span>└──────┬──────┘</span></span>\n<span class="line"><span>       ↓</span></span>\n<span class="line"><span>┌─────────────┐</span></span>\n<span class="line"><span>│4. CAPABILITY│  HMAC verification</span></span>\n<span class="line"><span>└──────┬──────┘</span></span>\n<span class="line"><span>       ↓</span></span>\n<span class="line"><span>┌─────────────┐</span></span>\n<span class="line"><span>│  5. POLICY  │  Rule evaluation</span></span>\n<span class="line"><span>└──────┬──────┘</span></span>\n<span class="line"><span>       ↓</span></span>\n<span class="line"><span>┌─────────────┐</span></span>\n<span class="line"><span>│  6. BUDGET  │  Resource check</span></span>\n<span class="line"><span>└──────┬──────┘</span></span>\n<span class="line"><span>       ↓</span></span>\n<span class="line"><span>┌─────────────┐</span></span>\n<span class="line"><span>│  7. TAINT   │  Information flow</span></span>\n<span class="line"><span>└──────┬──────┘</span></span>\n<span class="line"><span>       ↓</span></span>\n<span class="line"><span>┌─────────────┐</span></span>\n<span class="line"><span>│  8. EXECUTE │  Perform operation</span></span>\n<span class="line"><span>└──────┬──────┘</span></span>\n<span class="line"><span>       ↓</span></span>\n<span class="line"><span>┌─────────────┐</span></span>\n<span class="line"><span>│   9. LOG    │  Audit (before response)</span></span>\n<span class="line"><span>└──────┬──────┘</span></span>\n<span class="line"><span>       ↓</span></span>\n<span class="line"><span>┌─────────────┐</span></span>\n<span class="line"><span>│ 10. RESPOND │  Return result</span></span>\n<span class="line"><span>└─────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>Failure at any stage = immediate rejection.</p><h2 id="syscall-numbers" tabindex="-1">Syscall Numbers <a class="header-anchor" href="#syscall-numbers" aria-label="Permalink to &quot;Syscall Numbers&quot;">​</a></h2><p>Authority Kernel uses syscall numbers 1024-1100:</p><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Category: STATE */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_READ</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             1024</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Read heap object */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_ALLOC</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1025</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Allocate new object */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_WRITE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1026</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Patch object (CAS) */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_DELETE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           1027</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Soft-delete object */</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Category: TOOLS */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_CALL</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             1028</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Execute tool */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_BATCH</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1029</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Atomic batch */</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Category: AUDIT */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_COMMIT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           1030</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Force log commit */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_QUERY</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1031</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Query audit log */</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Category: CONTROL */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_SPAWN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1032</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Create child agent */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_SEND</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             1033</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Send message */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_RECV</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             1034</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Receive message */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_ASSERT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           1035</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Assert predicate */</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Category: OUTPUT */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_RESPOND</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          1036</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Send response */</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Category: COGNITIVE */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_INFERENCE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        1037</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* LLM gateway */</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Category: DENY UX */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AK_SYS_LAST_ERROR</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       1040</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Get last denial */</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="error-codes" tabindex="-1">Error Codes <a class="header-anchor" href="#error-codes" aria-label="Permalink to &quot;Error Codes&quot;">​</a></h2><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Protocol errors: -4000 to -4099 */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_FRAME_TOO_LARGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_SCHEMA_INVALID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4002</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Capability errors: -4100 to -4199 */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_CAP_MISSING</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_CAP_INVALID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4101</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_CAP_EXPIRED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4102</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_CAP_SCOPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4103</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_CAP_REVOKED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4104</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_CAP_RATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4105</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Policy errors: -4200 to -4299 */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_REPLAY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_POLICY_DENY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4201</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_APPROVAL_REQUIRED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4202</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_TAINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                 (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4203</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Resource errors: -4300 to -4399 */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_BUDGET_EXCEEDED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E_RATE_LIMIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="context-structure" tabindex="-1">Context Structure <a class="header-anchor" href="#context-structure" aria-label="Permalink to &quot;Context Structure&quot;">​</a></h2><p>Each thread has an Authority Kernel context:</p><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ak_ctx {</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    ak_agent_context_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">agent;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Agent state */</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Routing mode */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        AK_MODE_OFF,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              /* Legacy mode */</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        AK_MODE_SOFT,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             /* POSIX routed + enforced */</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        AK_MODE_HARD,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             /* Raw syscalls denied */</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } mode;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Last denial (for AK_SYS_LAST_ERROR) */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ak_last_deny {</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        ak_effect_op_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> op;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        char</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">512</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        char</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> missing_cap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        char</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> suggested_snippet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">512</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        u64 trace_id;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } last_deny;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Policy pointer */</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ak_policy_v2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">policy;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Boot capsule state */</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    boolean boot_capsule_active;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    boolean boot_capsule_dropped;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ak_ctx_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="canonicalization" tabindex="-1">Canonicalization <a class="header-anchor" href="#canonicalization" aria-label="Permalink to &quot;Canonicalization&quot;">​</a></h2><p>All targets are canonicalized before policy matching:</p><h3 id="filesystem-paths" tabindex="-1">Filesystem Paths <a class="header-anchor" href="#filesystem-paths" aria-label="Permalink to &quot;Filesystem Paths&quot;">​</a></h3><ul><li>Convert relative to absolute using process cwd</li><li>Normalize <code>.</code> and <code>..</code> segments</li><li>Lexical canonicalization (symlinks not resolved in P0)</li></ul><h3 id="network-addresses" tabindex="-1">Network Addresses <a class="header-anchor" href="#network-addresses" aria-label="Permalink to &quot;Network Addresses&quot;">​</a></h3><ul><li>Normalize IPv4-mapped IPv6 to IPv4</li><li>Consistent loopback handling</li><li>Format: <code>ip:&lt;addr&gt;:&lt;port&gt;</code> or <code>dns:&lt;host&gt;:&lt;port&gt;</code></li></ul><h3 id="dns" tabindex="-1">DNS <a class="header-anchor" href="#dns" aria-label="Permalink to &quot;DNS&quot;">​</a></h3><ul><li>Separate <code>net.dns</code> capability for resolution</li><li><code>net.connect</code> with <code>dns:</code> prefix requires prior DNS authorization</li></ul><h2 id="security-invariants" tabindex="-1">Security Invariants <a class="header-anchor" href="#security-invariants" aria-label="Permalink to &quot;Security Invariants&quot;">​</a></h2><p>The Authority Kernel enforces these invariants:</p><table tabindex="0"><thead><tr><th>ID</th><th>Invariant</th><th>Description</th></tr></thead><tbody><tr><td>INV-DENY</td><td>Deny-by-default</td><td>Active after boot capsule drop</td></tr><tr><td>INV-SINGLE</td><td>Single Gate</td><td><code>ak_authorize_and_execute()</code> is the only path</td></tr><tr><td>INV-CANONICAL</td><td>Canonicalization</td><td>Targets normalized before match</td></tr><tr><td>INV-BOUNDED</td><td>Bounded Buffers</td><td>Fixed maximum sizes</td></tr><tr><td>INV-AUDIT</td><td>Audit Logging</td><td>Denied effects logged (rate-limited)</td></tr><tr><td>INV-NO-BYPASS</td><td>No Bypass</td><td>Tools/WASM cannot skip AK</td></tr></tbody></table><p>See <a href="/security/invariants">Security Invariants</a> for complete documentation.</p>',37)])])}]]);export{l as __pageData,e as default};
