import{_ as a,c as i,o as e,ag as n}from"./chunks/framework.bCALENAD.js";const u=JSON.parse('{"title":"Fuzz Testing","description":"","frontmatter":{},"headers":[],"relativePath":"testing/fuzz-testing.md","filePath":"testing/fuzz-testing.md","lastUpdated":1768808469000}'),l={name:"testing/fuzz-testing.md"};function t(r,s,p,h,c,o){return e(),i("div",null,[...s[0]||(s[0]=[n(`<h1 id="fuzz-testing" tabindex="-1">Fuzz Testing <a class="header-anchor" href="#fuzz-testing" aria-label="Permalink to &quot;Fuzz Testing&quot;">​</a></h1><p>This page documents the fuzzing infrastructure for Authority Nanos.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>Fuzzing is critical for security-sensitive code like the Authority Kernel, where input parsing bugs could lead to:</p><ul><li>Policy bypass vulnerabilities</li><li>Path traversal attacks</li><li>Denial of service</li><li>Memory corruption</li></ul><h2 id="fuzz-targets" tabindex="-1">Fuzz Targets <a class="header-anchor" href="#fuzz-targets" aria-label="Permalink to &quot;Fuzz Targets&quot;">​</a></h2><h3 id="_1-json-policy-parser" tabindex="-1">1. JSON Policy Parser <a class="header-anchor" href="#_1-json-policy-parser" aria-label="Permalink to &quot;1. JSON Policy Parser&quot;">​</a></h3><p><strong>Target:</strong> <code>fuzz_json_parser.c</code></p><p>Tests the JSON policy parser (<code>ak_policy_v2.c</code>) with:</p><ul><li>Malformed JSON</li><li>Truncated input</li><li>Deeply nested structures</li><li>Large arrays/strings</li><li>Special characters and escape sequences</li></ul><h3 id="_2-pattern-matching" tabindex="-1">2. Pattern Matching <a class="header-anchor" href="#_2-pattern-matching" aria-label="Permalink to &quot;2. Pattern Matching&quot;">​</a></h3><p><strong>Target:</strong> <code>fuzz_pattern_match.c</code></p><p>Tests the glob pattern matcher (<code>ak_pattern.c</code>) with:</p><ul><li>Pathological patterns (many <code>*</code> characters)</li><li>Unicode and special characters</li><li>Edge cases like empty patterns</li><li>ReDoS-style attack patterns</li></ul><h3 id="_3-path-canonicalization" tabindex="-1">3. Path Canonicalization <a class="header-anchor" href="#_3-path-canonicalization" aria-label="Permalink to &quot;3. Path Canonicalization&quot;">​</a></h3><p><strong>Target:</strong> <code>fuzz_path_canonicalize.c</code></p><p>Tests path canonicalization (<code>ak_effects.c</code>) with:</p><ul><li>Path traversal attempts (<code>../../../etc/passwd</code>)</li><li>Null byte injection</li><li>Double slashes</li><li>Mixed <code>.</code> and <code>..</code> components</li><li>Very long paths</li></ul><h2 id="building" tabindex="-1">Building <a class="header-anchor" href="#building" aria-label="Permalink to &quot;Building&quot;">​</a></h2><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Build all fuzz targets</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test/fuzz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Build specific target</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fuzz_json_parser</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Build standalone debug versions (no fuzzer)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> standalone</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Requirements:</p><ul><li>clang with libFuzzer support</li><li>AddressSanitizer and UndefinedBehaviorSanitizer</li></ul><h2 id="running" tabindex="-1">Running <a class="header-anchor" href="#running" aria-label="Permalink to &quot;Running&quot;">​</a></h2><h3 id="quick-start" tabindex="-1">Quick Start <a class="header-anchor" href="#quick-start" aria-label="Permalink to &quot;Quick Start&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Run fuzzer for 60 seconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./fuzz_json_parser</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> corpus/json/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -max_total_time=60</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Run with multiple jobs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./fuzz_json_parser</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> corpus/json/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -jobs=4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -workers=4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Run with specific seed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./fuzz_json_parser</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> corpus/json/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -seed=12345</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="coverage-guided-fuzzing" tabindex="-1">Coverage-Guided Fuzzing <a class="header-anchor" href="#coverage-guided-fuzzing" aria-label="Permalink to &quot;Coverage-Guided Fuzzing&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Run with coverage</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./fuzz_json_parser</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> corpus/json/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -max_total_time=300</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -use_cmp=1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="corpus-management" tabindex="-1">Corpus Management <a class="header-anchor" href="#corpus-management" aria-label="Permalink to &quot;Corpus Management&quot;">​</a></h2><h3 id="initial-seeds" tabindex="-1">Initial Seeds <a class="header-anchor" href="#initial-seeds" aria-label="Permalink to &quot;Initial Seeds&quot;">​</a></h3><p>The <code>corpus/</code> directory contains seed inputs:</p><ul><li><code>corpus/json/</code> - JSON policy examples</li><li><code>corpus/pattern/</code> - Pattern matching test cases</li><li><code>corpus/path/</code> - Path canonicalization inputs</li></ul><h3 id="generating-corpus" tabindex="-1">Generating Corpus <a class="header-anchor" href="#generating-corpus" aria-label="Permalink to &quot;Generating Corpus&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> corpus</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="minimizing-corpus" tabindex="-1">Minimizing Corpus <a class="header-anchor" href="#minimizing-corpus" aria-label="Permalink to &quot;Minimizing Corpus&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> minimize</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="interpreting-results" tabindex="-1">Interpreting Results <a class="header-anchor" href="#interpreting-results" aria-label="Permalink to &quot;Interpreting Results&quot;">​</a></h2><h3 id="crash-files" tabindex="-1">Crash Files <a class="header-anchor" href="#crash-files" aria-label="Permalink to &quot;Crash Files&quot;">​</a></h3><p>If a crash is found, a file like <code>crash-&lt;hash&gt;</code> is created. To reproduce:</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./fuzz_json_parser</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> crash-abc123</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="leak-files" tabindex="-1">Leak Files <a class="header-anchor" href="#leak-files" aria-label="Permalink to &quot;Leak Files&quot;">​</a></h3><p>Memory leaks are recorded in <code>leak-&lt;hash&gt;</code> files.</p><h3 id="timeout-files" tabindex="-1">Timeout Files <a class="header-anchor" href="#timeout-files" aria-label="Permalink to &quot;Timeout Files&quot;">​</a></h3><p>Inputs causing timeouts are saved as <code>timeout-&lt;hash&gt;</code>.</p><h2 id="what-fuzzing-catches" tabindex="-1">What Fuzzing Catches <a class="header-anchor" href="#what-fuzzing-catches" aria-label="Permalink to &quot;What Fuzzing Catches&quot;">​</a></h2><p>The fuzz targets detect:</p><ol><li><p><strong>Memory Safety Issues</strong></p><ul><li>Buffer overflows</li><li>Use-after-free</li><li>Uninitialized memory reads</li></ul></li><li><p><strong>Logic Bugs</strong></p><ul><li>Incorrect parsing</li><li>Pattern matching bypasses</li><li>Path traversal vulnerabilities</li></ul></li><li><p><strong>Resource Exhaustion</strong></p><ul><li>Exponential backtracking (ReDoS)</li><li>Excessive memory allocation</li><li>Infinite loops</li></ul></li></ol><h2 id="ci-integration" tabindex="-1">CI Integration <a class="header-anchor" href="#ci-integration" aria-label="Permalink to &quot;CI Integration&quot;">​</a></h2><p>Add to your CI pipeline:</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">fuzz_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cd test/fuzz</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">make</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">make corpus</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./fuzz_json_parser corpus/json/ -max_total_time=30</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./fuzz_pattern_match corpus/pattern/ -max_total_time=30</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./fuzz_path_canonicalize corpus/path/ -max_total_time=30</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  artifacts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">test/fuzz/crash-*</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">test/fuzz/leak-*</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    when</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">on_failure</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-label="Permalink to &quot;References&quot;">​</a></h2><ul><li><a href="/design/bug-checklist">Bug Checklist</a> - Known issues found via fuzzing</li><li><a href="/testing/">Testing Documentation</a> - All testing resources</li></ul>`,51)])])}const k=a(l,[["render",t]]);export{u as __pageData,k as default};
