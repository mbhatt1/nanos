import{_ as a,c as s,o as n,ah as e}from"./chunks/framework.CI1pfr7V.js";const i=JSON.parse('{"title":"Fork Relationship","description":"","frontmatter":{},"headers":[],"relativePath":"architecture/nanos-fork.md","filePath":"architecture/nanos-fork.md","lastUpdated":1768627190000}');const t=a({name:"architecture/nanos-fork.md"},[["render",function(a,i,t,r,l,p){return n(),s("div",null,[...i[0]||(i[0]=[e('<h1 id="fork-relationship" tabindex="-1">Fork Relationship <a class="header-anchor" href="#fork-relationship" aria-label="Permalink to &quot;Fork Relationship&quot;">​</a></h1><p>Authority Nanos is a <strong>fork of <a href="https://github.com/mbhatt1/nanos" target="_blank" rel="noreferrer">Nanos</a></strong> — the original unikernel developed by <a href="https://nanovms.com" target="_blank" rel="noreferrer">NanoVMs</a>.</p><h2 id="what-is-nanos" tabindex="-1">What is Nanos? <a class="header-anchor" href="#what-is-nanos" aria-label="Permalink to &quot;What is Nanos?&quot;">​</a></h2><p>Nanos is a production-quality unikernel designed to run single applications with minimal overhead:</p><ul><li><strong>Single-process</strong>: No fork, exec, or multiple users</li><li><strong>Minimal syscalls</strong>: Only what applications need</li><li><strong>Fast startup</strong>: Boots in milliseconds</li><li><strong>Small footprint</strong>: ~20MB base memory</li><li><strong>Cross-platform</strong>: x86_64 and ARM64</li></ul><h2 id="what-authority-nanos-adds" tabindex="-1">What Authority Nanos Adds <a class="header-anchor" href="#what-authority-nanos-adds" aria-label="Permalink to &quot;What Authority Nanos Adds&quot;">​</a></h2><p>Authority Nanos extends Nanos with the <strong>Authority Kernel</strong> subsystem:</p><table tabindex="0"><thead><tr><th>Feature</th><th>Nanos</th><th>Authority Nanos</th></tr></thead><tbody><tr><td>Unikernel base</td><td>Yes</td><td>Yes</td></tr><tr><td>Cross-platform</td><td>Yes</td><td>Yes</td></tr><tr><td>Capability-based security</td><td>No</td><td>Yes</td></tr><tr><td>Deny-by-default policy</td><td>No</td><td>Yes</td></tr><tr><td>Audit logging</td><td>No</td><td>Yes (hash-chained)</td></tr><tr><td>Budget enforcement</td><td>No</td><td>Yes</td></tr><tr><td>LLM integration</td><td>No</td><td>Yes (native)</td></tr><tr><td>Tool sandboxing</td><td>No</td><td>Yes (WASM)</td></tr></tbody></table><h2 id="repository-structure" tabindex="-1">Repository Structure <a class="header-anchor" href="#repository-structure" aria-label="Permalink to &quot;Repository Structure&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>authority-nanos/</span></span>\n<span class="line"><span>├── nanos/                   # Nanos kernel (with AK additions)</span></span>\n<span class="line"><span>│   └── src/</span></span>\n<span class="line"><span>│       └── agentic/        # Authority Kernel implementation</span></span>\n<span class="line"><span>├── docs/                    # Documentation (this site)</span></span>\n<span class="line"><span>├── IMPLEMENTATION_SPEC.md   # AK technical specification</span></span>\n<span class="line"><span>└── SECURITY_INVARIANTS.md   # Security guarantees</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="upstream-compatibility" tabindex="-1">Upstream Compatibility <a class="header-anchor" href="#upstream-compatibility" aria-label="Permalink to &quot;Upstream Compatibility&quot;">​</a></h2><p>Authority Nanos maintains <strong>full compatibility</strong> with upstream Nanos:</p><ul><li>All existing Nanos applications run unchanged (with <code>AK_MODE_OFF</code>)</li><li>Standard ops workflows continue to work</li><li>No breaking changes to the POSIX compatibility layer</li></ul><h2 id="the-authority-kernel-files" tabindex="-1">The Authority Kernel Files <a class="header-anchor" href="#the-authority-kernel-files" aria-label="Permalink to &quot;The Authority Kernel Files&quot;">​</a></h2><p>The Authority Kernel is implemented in <code>nanos/src/agentic/</code>:</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>src/agentic/</span></span>\n<span class="line"><span>├── ak_config.h          # Feature toggles and limits</span></span>\n<span class="line"><span>├── ak_types.h           # Core type definitions</span></span>\n<span class="line"><span>├── ak_syscall.c         # Syscall dispatch (1024-1100)</span></span>\n<span class="line"><span>├── ak_policy.c          # Policy loading and evaluation</span></span>\n<span class="line"><span>├── ak_audit.c           # Hash-chained audit log</span></span>\n<span class="line"><span>├── ak_capability.c      # HMAC token verification</span></span>\n<span class="line"><span>├── ak_effects.c         # Effect authorization</span></span>\n<span class="line"><span>├── ak_context.c         # Per-thread context</span></span>\n<span class="line"><span>├── ak_wasm.c            # WASM sandbox runtime</span></span>\n<span class="line"><span>├── ak_inference.c       # LLM gateway</span></span>\n<span class="line"><span>└── README.md            # Component documentation</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="build-configuration" tabindex="-1">Build Configuration <a class="header-anchor" href="#build-configuration" aria-label="Permalink to &quot;Build Configuration&quot;">​</a></h2><p>The Authority Kernel is enabled by default:</p><div class="language-makefile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In kernel.mk</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CFLAGS += -DCONFIG_AK_ENABLED=1</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CFLAGS += -DCONFIG_AK_EFFECTS=1</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CFLAGS += -DAK_DEFAULT_MODE=AK_MODE_SOFT</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>To build without Authority Kernel (pure Nanos):</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kernel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CONFIG_AK_ENABLED=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="contributing-back-to-nanos" tabindex="-1">Contributing Back to Nanos <a class="header-anchor" href="#contributing-back-to-nanos" aria-label="Permalink to &quot;Contributing Back to Nanos&quot;">​</a></h2><p>Improvements to the core Nanos kernel (not Authority Kernel specific) should be contributed upstream:</p><ol><li>Identify if the change is AK-specific or general Nanos</li><li>For general changes, submit PR to <a href="https://github.com/mbhatt1/nanos" target="_blank" rel="noreferrer">nanovms/nanos</a></li><li>For AK-specific changes, submit PR to Authority Nanos</li></ol><h2 id="why-fork" tabindex="-1">Why Fork? <a class="header-anchor" href="#why-fork" aria-label="Permalink to &quot;Why Fork?&quot;">​</a></h2><p>Forking allows Authority Nanos to:</p><ol><li><strong>Add security features</strong> that aren&#39;t needed for general-purpose unikernels</li><li><strong>Maintain AI-first focus</strong> without burdening the main Nanos project</li><li><strong>Move fast</strong> on agent-specific features while Nanos maintains stability</li><li><strong>Stay compatible</strong> by regularly merging upstream changes</li></ol><h2 id="syncing-with-upstream" tabindex="-1">Syncing with Upstream <a class="header-anchor" href="#syncing-with-upstream" aria-label="Permalink to &quot;Syncing with Upstream&quot;">​</a></h2><p>Authority Nanos periodically syncs with upstream Nanos:</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Add upstream remote</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remote</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upstream</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/mbhatt1/nanos.git</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Fetch upstream changes</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fetch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upstream</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Merge into authority-nanos</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> merge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upstream/master</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Most merges are clean since Authority Kernel code lives in a separate directory (<code>src/agentic/</code>).</p>',31)])])}]]);export{i as __pageData,t as default};
