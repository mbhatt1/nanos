import{_ as s,c as i,o as e,ag as n}from"./chunks/framework.bCALENAD.js";const k=JSON.parse('{"title":"Build Scripts and Utilities","description":"","frontmatter":{},"headers":[],"relativePath":"tools/scripts.md","filePath":"tools/scripts.md","lastUpdated":1768808469000}'),t={name:"tools/scripts.md"};function l(p,a,r,h,o,d){return e(),i("div",null,[...a[0]||(a[0]=[n(`<h1 id="build-scripts-and-utilities" tabindex="-1">Build Scripts and Utilities <a class="header-anchor" href="#build-scripts-and-utilities" aria-label="Permalink to &quot;Build Scripts and Utilities&quot;">​</a></h1><p>This page documents build scripts and automation utilities for Authority Nanos development.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The <code>scripts/</code> directory contains utility scripts for code formatting, building, and development automation.</p><h2 id="code-formatting" tabindex="-1">Code Formatting <a class="header-anchor" href="#code-formatting" aria-label="Permalink to &quot;Code Formatting&quot;">​</a></h2><h3 id="apply-format" tabindex="-1">apply-format <a class="header-anchor" href="#apply-format" aria-label="Permalink to &quot;apply-format&quot;">​</a></h3><p>Automatically formats code according to the project&#39;s style guide.</p><h4 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">​</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># macOS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clang-format-hooks</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Linux</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply-format</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="usage" tabindex="-1">Usage <a class="header-anchor" href="#usage" aria-label="Permalink to &quot;Usage&quot;">​</a></h4><p>Format modified files:</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scripts/apply-format</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>This reformats only the code that <code>git diff</code> would show and prints the diff to the terminal.</p><h4 id="options" tabindex="-1">Options <a class="header-anchor" href="#options" aria-label="Permalink to &quot;Options&quot;">​</a></h4><p>For more options, see the <a href="https://github.com/barisione/clang-format-hooks" target="_blank" rel="noreferrer">clang-format-hooks documentation</a></p><h4 id="applying-changes" tabindex="-1">Applying Changes <a class="header-anchor" href="#applying-changes" aria-label="Permalink to &quot;Applying Changes&quot;">​</a></h4><p>To apply the formatting changes:</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scripts/apply-format</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changes.patch</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changes.patch</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Or apply interactively:</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scripts/apply-format</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="common-development-tasks" tabindex="-1">Common Development Tasks <a class="header-anchor" href="#common-development-tasks" aria-label="Permalink to &quot;Common Development Tasks&quot;">​</a></h2><h3 id="build-with-tracing" tabindex="-1">Build with Tracing <a class="header-anchor" href="#build-with-tracing" aria-label="Permalink to &quot;Build with Tracing&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TRACE=ftrace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TARGET=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">targe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="run-tests" tabindex="-1">Run Tests <a class="header-anchor" href="#run-tests" aria-label="Permalink to &quot;Run Tests&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test/unit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test/runtime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./tools/smoke.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="run-fuzz-tests" tabindex="-1">Run Fuzz Tests <a class="header-anchor" href="#run-fuzz-tests" aria-label="Permalink to &quot;Run Fuzz Tests&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test/fuzz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./fuzz_json_parser</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> corpus/json/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -max_total_time=60</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="clean-build" tabindex="-1">Clean Build <a class="header-anchor" href="#clean-build" aria-label="Permalink to &quot;Clean Build&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PLATFORM=pc</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="policy-compilation" tabindex="-1">Policy Compilation <a class="header-anchor" href="#policy-compilation" aria-label="Permalink to &quot;Policy Compilation&quot;">​</a></h2><p>Policy TOML files are automatically compiled to JSON at build time:</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Build compiles ak.toml -&gt; policy.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PLATFORM=pc</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="release-management" tabindex="-1">Release Management <a class="header-anchor" href="#release-management" aria-label="Permalink to &quot;Release Management&quot;">​</a></h2><p>Release process steps:</p><ol><li>Create <a href="https://github.com/nanovms/authority-nanos/releases" target="_blank" rel="noreferrer">GitHub release</a></li><li>Build on both Linux and macOS</li><li>Update version files</li><li>Run release script:<div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./release.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><p>See <a href="/guide/release-notes">Release Notes</a> for detailed process.</p><h2 id="smoke-test" tabindex="-1">Smoke Test <a class="header-anchor" href="#smoke-test" aria-label="Permalink to &quot;Smoke Test&quot;">​</a></h2><p>Basic verification that kernel boots and denies unpermitted operations:</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./tools/smoke.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>This:</p><ul><li>Builds the kernel</li><li>Creates test image with minimal policy</li><li>Boots and verifies deny-by-default</li><li>Checks last_deny information</li></ul><h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-label="Permalink to &quot;References&quot;">​</a></h2><ul><li><a href="/testing/">Testing Documentation</a> - Test infrastructure</li><li><a href="/tools/trace-utilities">Trace Utilities</a> - Performance analysis tools</li><li><a href="/guide/contributing">Contributing Guide</a> - Code contribution standards</li></ul>`,43)])])}const u=s(t,[["render",l]]);export{k as __pageData,u as default};
