import{_ as a,c as i,o as n,ah as e}from"./chunks/framework.CpSv75ol.js";const c=JSON.parse('{"title":"Authority Kernel","description":"","frontmatter":{},"headers":[],"relativePath":"design/agentic-kernel.md","filePath":"design/agentic-kernel.md","lastUpdated":1768808469000}'),t={name:"design/agentic-kernel.md"};function l(p,s,h,r,k,d){return n(),i("div",null,[...s[0]||(s[0]=[e(`<h1 id="authority-kernel" tabindex="-1">Authority Kernel <a class="header-anchor" href="#authority-kernel" aria-label="Permalink to &quot;Authority Kernel&quot;">​</a></h1><p><strong>The Security Layer Powering Authority Nanos</strong></p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The Authority Kernel (AK) is the security subsystem that makes <strong>Authority Nanos</strong> the premier unikernel for AI agents. It implements a capability-based security model with comprehensive audit logging, ensuring that autonomous agents operate within strictly defined boundaries while maintaining complete auditability.</p><p>Authority Nanos = Nanos unikernel + Authority Kernel subsystem</p><h2 id="security-invariants" tabindex="-1">Security Invariants <a class="header-anchor" href="#security-invariants" aria-label="Permalink to &quot;Security Invariants&quot;">​</a></h2><p>The Authority Kernel enforces four fundamental security invariants:</p><h3 id="inv-1-no-bypass-invariant" tabindex="-1">INV-1: No-Bypass Invariant <a class="header-anchor" href="#inv-1-no-bypass-invariant" aria-label="Permalink to &quot;INV-1: No-Bypass Invariant&quot;">​</a></h3><blockquote><p>Every external effect occurs through a kernel-mediated syscall.</p></blockquote><p>The unikernel boundary ensures no direct hardware or network access bypasses the kernel.</p><h3 id="inv-2-capability-invariant" tabindex="-1">INV-2: Capability Invariant <a class="header-anchor" href="#inv-2-capability-invariant" aria-label="Permalink to &quot;INV-2: Capability Invariant&quot;">​</a></h3><blockquote><p>Every effectful syscall must carry a valid, non-revoked capability whose scope subsumes the request.</p></blockquote><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">s64 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ak_capability_validate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    ak_capability_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    ak_cap_type_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> required_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    u8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">run_id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="inv-3-budget-invariant" tabindex="-1">INV-3: Budget Invariant <a class="header-anchor" href="#inv-3-budget-invariant" aria-label="Permalink to &quot;INV-3: Budget Invariant&quot;">​</a></h3><blockquote><p>The sum of in-flight and committed costs never exceeds budget.</p></blockquote><p>Admission control prevents resource exhaustion:</p><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">s64 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ak_budget_reserve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ak_budget_tracker_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tracker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                      ak_resource_type_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, u64 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">amount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="inv-4-log-commitment-invariant" tabindex="-1">INV-4: Log Commitment Invariant <a class="header-anchor" href="#inv-4-log-commitment-invariant" aria-label="Permalink to &quot;INV-4: Log Commitment Invariant&quot;">​</a></h3><blockquote><p>Each committed transition appends a log entry whose hash chain validates from genesis to head.</p></blockquote><p>Tamper-evident audit log with hash chain:</p><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">s64 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ak_audit_append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, u8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">run_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, u16 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">op</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    u8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req_hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, u8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res_hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, u8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">policy_hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="architecture" tabindex="-1">Architecture <a class="header-anchor" href="#architecture" aria-label="Permalink to &quot;Architecture&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                      Agent Process                          │</span></span>
<span class="line"><span>│  ┌─────────────────────────────────────────────────────┐   │</span></span>
<span class="line"><span>│  │                   Agent Code                         │   │</span></span>
<span class="line"><span>│  │  • LLM Inference       • Tool Execution             │   │</span></span>
<span class="line"><span>│  │  • State Management    • Communication              │   │</span></span>
<span class="line"><span>│  └────────────────────────┬────────────────────────────┘   │</span></span>
<span class="line"><span>│                           │ AK Syscalls (1024-1100)        │</span></span>
<span class="line"><span>├───────────────────────────┼─────────────────────────────────┤</span></span>
<span class="line"><span>│                           ▼                                 │</span></span>
<span class="line"><span>│  ┌─────────────────────────────────────────────────────┐   │</span></span>
<span class="line"><span>│  │              Authority Kernel                        │   │</span></span>
<span class="line"><span>│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐            │   │</span></span>
<span class="line"><span>│  │  │Capability│ │  Audit   │ │  Policy  │            │   │</span></span>
<span class="line"><span>│  │  │  System  │ │   Log    │ │  Engine  │            │   │</span></span>
<span class="line"><span>│  │  └──────────┘ └──────────┘ └──────────┘            │   │</span></span>
<span class="line"><span>│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐            │   │</span></span>
<span class="line"><span>│  │  │  Typed   │ │   IPC    │ │ Syscall  │            │   │</span></span>
<span class="line"><span>│  │  │   Heap   │ │Transport │ │ Dispatch │            │   │</span></span>
<span class="line"><span>│  │  └──────────┘ └──────────┘ └──────────┘            │   │</span></span>
<span class="line"><span>│  └─────────────────────────────────────────────────────┘   │</span></span>
<span class="line"><span>│                    Nanos Kernel                             │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="syscall-interface" tabindex="-1">Syscall Interface <a class="header-anchor" href="#syscall-interface" aria-label="Permalink to &quot;Syscall Interface&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Number</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>1024</td><td>READ</td><td>Read object from typed heap</td></tr><tr><td>1025</td><td>ALLOC</td><td>Allocate new heap object</td></tr><tr><td>1026</td><td>WRITE</td><td>Update object with JSON Patch</td></tr><tr><td>1027</td><td>DELETE</td><td>Soft-delete object</td></tr><tr><td>1028</td><td>QUERY</td><td>Query objects by predicate</td></tr><tr><td>1029</td><td>BATCH</td><td>Atomic batch operations</td></tr><tr><td>1030</td><td>COMMIT</td><td>Checkpoint audit log</td></tr><tr><td>1031</td><td>CALL</td><td>Invoke tool in WASM sandbox</td></tr><tr><td>1032</td><td>SPAWN</td><td>Create child agent</td></tr><tr><td>1033</td><td>SEND</td><td>Send message to agent</td></tr><tr><td>1034</td><td>RECV</td><td>Receive messages</td></tr><tr><td>1035</td><td>RESPOND</td><td>Send response to orchestrator</td></tr><tr><td>1036</td><td>ASSERT</td><td>Record assertion</td></tr><tr><td>1037</td><td>INFERENCE</td><td>Invoke LLM</td></tr></tbody></table><h2 id="components" tabindex="-1">Components <a class="header-anchor" href="#components" aria-label="Permalink to &quot;Components&quot;">​</a></h2><h3 id="capability-system-ak-capability-h-c" tabindex="-1">Capability System (<code>ak_capability.h/c</code>) <a class="header-anchor" href="#capability-system-ak-capability-h-c" aria-label="Permalink to &quot;Capability System (\`ak_capability.h/c\`)&quot;">​</a></h3><ul><li>HMAC-SHA256 signed tokens</li><li>Scope-based access control</li><li>Key rotation with grace period</li><li>Constant-time verification</li><li>Immediate revocation</li></ul><h3 id="typed-heap-ak-heap-h-c" tabindex="-1">Typed Heap (<code>ak_heap.h/c</code>) <a class="header-anchor" href="#typed-heap-ak-heap-h-c" aria-label="Permalink to &quot;Typed Heap (\`ak_heap.h/c\`)&quot;">​</a></h3><ul><li>Versioned objects with CAS semantics</li><li>JSON Schema validation</li><li>RFC 6902 JSON Patch support</li><li>Transaction support for BATCH</li><li>Taint tracking</li></ul><h3 id="audit-log-ak-audit-h-c" tabindex="-1">Audit Log (<code>ak_audit.h/c</code>) <a class="header-anchor" href="#audit-log-ak-audit-h-c" aria-label="Permalink to &quot;Audit Log (\`ak_audit.h/c\`)&quot;">​</a></h3><ul><li>Hash-chained entries</li><li>Crash recovery</li><li>External anchoring</li><li>Replay bundle support</li></ul><h3 id="policy-engine-ak-policy-h-c" tabindex="-1">Policy Engine (<code>ak_policy.h/c</code>) <a class="header-anchor" href="#policy-engine-ak-policy-h-c" aria-label="Permalink to &quot;Policy Engine (\`ak_policy.h/c\`)&quot;">​</a></h3><ul><li>JSON/YAML policy format</li><li>Budget enforcement</li><li>Tool allowlists</li><li>Domain restrictions</li><li>Taint flow rules</li></ul><h3 id="ipc-transport-ak-ipc-h-c" tabindex="-1">IPC Transport (<code>ak_ipc.h/c</code>) <a class="header-anchor" href="#ipc-transport-ak-ipc-h-c" aria-label="Permalink to &quot;IPC Transport (\`ak_ipc.h/c\`)&quot;">​</a></h3><ul><li>Framed protocol with CRC-32C</li><li>Sequence-based replay protection</li><li>JSON serialization</li></ul><h3 id="syscall-dispatcher-ak-syscall-h-c" tabindex="-1">Syscall Dispatcher (<code>ak_syscall.h/c</code>) <a class="header-anchor" href="#syscall-dispatcher-ak-syscall-h-c" aria-label="Permalink to &quot;Syscall Dispatcher (\`ak_syscall.h/c\`)&quot;">​</a></h3><ul><li>Central enforcement point</li><li>10-stage validation pipeline</li><li>Per-operation handlers</li></ul><h2 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">​</a></h2><h3 id="policy-format-json" tabindex="-1">Policy Format (JSON) <a class="header-anchor" href="#policy-format-json" aria-label="Permalink to &quot;Policy Format (JSON)&quot;">​</a></h3><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;budgets&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;tokens&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;calls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;inference_ms&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;file_bytes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10485760</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;tools&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;allow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;file_read&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http_get&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;deny&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;shell_exec&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;domains&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;allow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;*.github.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;deny&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;*.internal&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="security-considerations" tabindex="-1">Security Considerations <a class="header-anchor" href="#security-considerations" aria-label="Permalink to &quot;Security Considerations&quot;">​</a></h2><h3 id="fail-closed-design" tabindex="-1">Fail-Closed Design <a class="header-anchor" href="#fail-closed-design" aria-label="Permalink to &quot;Fail-Closed Design&quot;">​</a></h3><p>All validation functions return denial by default:</p><ul><li>Unknown capability → denied</li><li>Missing policy → denied</li><li>Taint violation → denied</li></ul><h3 id="timing-attack-resistance" tabindex="-1">Timing Attack Resistance <a class="header-anchor" href="#timing-attack-resistance" aria-label="Permalink to &quot;Timing Attack Resistance&quot;">​</a></h3><p>Capability verification uses constant-time comparison:</p><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> boolean </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">constant_time_compare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, u8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, u64 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    u8 result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (u64 i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> len; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[i];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="capability-revocation" tabindex="-1">Capability Revocation <a class="header-anchor" href="#capability-revocation" aria-label="Permalink to &quot;Capability Revocation&quot;">​</a></h3><p>Revocation is immediate and persistent:</p><ul><li>Stored in revocation map</li><li>Survives kernel restart</li><li>Logged to audit trail</li></ul><h3 id="audit-log-integrity" tabindex="-1">Audit Log Integrity <a class="header-anchor" href="#audit-log-integrity" aria-label="Permalink to &quot;Audit Log Integrity&quot;">​</a></h3><p>Hash chain prevents undetected tampering:</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>hash[n] = SHA256(hash[n-1] || entry[n])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="testing" tabindex="-1">Testing <a class="header-anchor" href="#testing" aria-label="Permalink to &quot;Testing&quot;">​</a></h2><h3 id="unit-tests" tabindex="-1">Unit Tests <a class="header-anchor" href="#unit-tests" aria-label="Permalink to &quot;Unit Tests&quot;">​</a></h3><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_capability_verify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_heap_cas_semantics</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_audit_chain_integrity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_policy_evaluation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="integration-tests" tabindex="-1">Integration Tests <a class="header-anchor" href="#integration-tests" aria-label="Permalink to &quot;Integration Tests&quot;">​</a></h3><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_full_syscall_pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_batch_atomicity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_revocation_propagation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="security-tests" tabindex="-1">Security Tests <a class="header-anchor" href="#security-tests" aria-label="Permalink to &quot;Security Tests&quot;">​</a></h3><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_replay_detection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_capability_forgery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_taint_flow_blocking</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_budget_exhaustion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="license" tabindex="-1">License <a class="header-anchor" href="#license" aria-label="Permalink to &quot;License&quot;">​</a></h2><p>Apache-2.0</p><h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-label="Permalink to &quot;References&quot;">​</a></h2><ul><li><a href="/">Authority Nanos Main Documentation</a></li><li><a href="./ak-design">Authority Kernel Design</a></li><li><a href="./invariants">Security Invariants</a></li><li><a href="./ak-threat-model">Threat Model</a></li><li><a href="/faq">Authority Nanos FAQ</a></li><li><a href="https://github.com/nanovms/nanos" target="_blank" rel="noreferrer">Nanos Unikernel</a></li><li><a href="https://tools.ietf.org/html/rfc6902" target="_blank" rel="noreferrer">RFC 6902: JSON Patch</a></li><li><a href="https://json-schema.org/" target="_blank" rel="noreferrer">JSON Schema</a></li></ul>`,65)])])}const u=a(t,[["render",l]]);export{c as __pageData,u as default};
